import { verifyDpkSignature } from './devicePubKey';

it('should verify a device public key extension', async () => {
  const clientDataJSON = 'eyJ0eXBlIjoid2ViYXV0aG4uZ2V0IiwiY2hhbGxlbmdlIjoicTh1SVR0d0czMkhUU3RmdlVxVTcwWXNGNFJfS1A4WnZEYkVESVpZekNDdyIsIm9yaWdpbiI6ImFuZHJvaWQ6YXBrLWtleS1oYXNoOmd4N3NxX3B4aHhocklRZEx5ZkcwcHhLd2lKN2hPazJESlE0eHZLZDQzOFEiLCJhbmRyb2lkUGFja2FnZU5hbWUiOiJjb20uZmlkby5leGFtcGxlLmZpZG8yYXBpZXhhbXBsZSJ9';
  const authData = Buffer.from('0D75FCC563FDA779DB2E343EEA489888758B78549D493A4FDBEA1CD96AA31CC4C5000000000000000000000000000000000000000000107318C30758799C6EA3A505B711E79934A50102032620012158208BA46FDB7E12D19439ADADE98889100833EC6CAA04DE031530B391C322506A882258209A6E86CC13D2CCFF486099D7FBCF51FF398A97AFAA412790DAAA26102E82AF7DA16C6465766963655075624B6579A56364706B584DA5010203262001215820EDEAD3FD35769C23D340DDC1830A7FF20E7355F29D1C75AA0DC2B6AC182EA7D32258203451DC9992AF946825B441945FC9D134E17B73AA5FEA9580351E7C93F5D36513637369675846304402200B1F095D8FCE1E0AC83D7F47C70FD87296950AF0DFD318E04A0503E836F7D68D02200A12147DD6CED4705ABF16D9190C48B78BF6DC5A852C1DA7CF08A9F9ABC9E9EB656E6F6E6365406573636F70654100666161677569645000000000000000000000000000000000', 'hex');
  const devicePubKey = {
    aaguid: Buffer.from('B93FD961F2E6462FB12282002247DE78', 'hex'),
    dpk: Buffer.from('A5010203262001215820EDEAD3FD35769C23D340DDC1830A7FF20E7355F29D1C75AA0DC2B6AC182EA7D32258203451DC9992AF946825B441945FC9D134E17B73AA5FEA9580351E7C93F5D36513', 'hex'),
    sig: Buffer.from('3045022100BC6DD9AF5E47BB3AB82731299EAE82A779189E4E416E3A0E37A3BA64C38F991202205671EFAC0E8CD6DE1D3640CE7E4E89D3A97E0517B603D8AC28F23E4E1F74E639', 'hex'),
    nonce: Buffer.from('', 'hex'),
    scope: Buffer.from('00', 'hex')
  }
  const signature = devicePubKey.sig;
  
  const result = await verifyDpkSignature(clientDataJSON, authData, devicePubKey, signature);
  expect(result).toEqual(true);
});
